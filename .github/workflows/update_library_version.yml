name: Update Notion Dependencies Database

on:
  push:
    branches:
      - main
      - develop
    paths:
      - 'Podfile.lock'
      - '**/Package.resolved'
  
  workflow_dispatch:

jobs:
  update-notion:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 2

    - name: Check env presence
      env:
        NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
        NOTION_DATABASE_ID: ${{ secrets.NOTION_DATABASE_ID }}
        PROJECT_NAME: ${{ github.repository }}
      run: |
        if [ -n "${NOTION_TOKEN}" ]; then echo "NOTION_TOKEN: set"; else echo "NOTION_TOKEN: missing"; fi
        if [ -n "${NOTION_DATABASE_ID}" ]; then echo "NOTION_DATABASE_ID: set"; else echo "NOTION_DATABASE_ID: missing"; fi
        if [ -n "${PROJECT_NAME}" ]; then echo "PROJECT_NAME: set"; else echo "PROJECT_NAME: missing"; fi

    - name: Update Notion database
      env:
        NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
        NOTION_DATABASE_ID: ${{ secrets.NOTION_DATABASE_ID }}
        PROJECT_NAME: ${{ github.repository }}
        GITHUB_REF_NAME: ${{ github.ref_name }}
        GITHUB_EVENT_NAME: ${{ github.event_name }}
      run: |
        chmod +x Scripts/update_notion.sh
        ./Scripts/update_notion.sh
